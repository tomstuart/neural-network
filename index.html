<!doctype html>

<html>
  <head>
    <meta charset="utf-8">
    <script src="neural_network.js"></script>
  </head>

  <body>
    <canvas id="canvas" width="500" height="500"></canvas>
    <script>
      var neuralNetwork = new NeuralNetwork();

      var canvas = document.getElementById('canvas');
      var context = canvas.getContext('2d');

      var minX = -1;
      var minY = -1;
      var maxX = 1;
      var maxY = 1;

      var width = maxX - minX;
      var height = maxY - minY;

      var xScale = canvas.width / width;
      var yScale = canvas.height / height;

      var lineWidth = 1;

      context.scale(xScale, yScale);
      context.translate(-minX, -minY);
      context.lineWidth = lineWidth / xScale;

      var rectangularToPolar = function (p) {
        magnitude = Math.sqrt(p.x * p.x + p.y * p.y);
        angle = Math.atan(p.y / p.x);

        if (p.x < 0) {
          angle += Math.PI;
        }
        if (p.y < 0 && p.x > 0) {
          angle += 2 * Math.PI;
        }

        return { magnitude: magnitude, angle: angle };
      };

      var update = function () {
        context.clearRect(minX, minY, width, height);

        context.strokeStyle = 'red';

        context.setLineDash([0.01, 0.03]);
        context.beginPath();
        context.arc(0, 0, 1, 0, Math.PI * 2);
        context.stroke();

        context.setLineDash([]);
        context.beginPath();
        context.moveTo(minX, 0);
        context.lineTo(maxX, 0);
        context.moveTo(0, minY);
        context.lineTo(0, maxY);
        context.stroke();

        context.strokeStyle = 'black';
        context.beginPath();
        context.arc(neuralNetwork.output[0], neuralNetwork.output[1], 0.05, 0, Math.PI * 2);
        context.fill();
      };

      for (var i = 0; i < 1000000; ++i) {
        var rectangular = {
          x: minX + width * Math.random(),
          y: minY + height * Math.random()
        };
        var polar = rectangularToPolar(rectangular);

        neuralNetwork.compute(polar.magnitude, polar.angle);
        neuralNetwork.learn(rectangular.x, rectangular.y);
      }

      update();

      canvas.addEventListener('mousemove', function (event) {
        var rect = canvas.getBoundingClientRect();
        var rectangular = {
          x: minX + (event.clientX - rect.left) / xScale,
          y: minY + (event.clientY - rect.top) / yScale
        };
        var polar = rectangularToPolar(rectangular);

        neuralNetwork.compute(polar.magnitude, polar.angle);

        update();
      });
    </script>
  </body>
</html>
