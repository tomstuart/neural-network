<!doctype html>

<html>
  <head>
    <meta charset="utf-8">
    <script src="neural_network.js"></script>
  </head>

  <body>
    <canvas id="canvas" width="500" height="500"></canvas>
    <script>
      var neuralNetwork = new NeuralNetwork();
      var iterationsPerFrame = 1000;

      var canvas = document.getElementById('canvas');
      var context = canvas.getContext('2d');

      var minX = -1;
      var minY = -1;
      var maxX = 1;
      var maxY = 1;

      var width = maxX - minX;
      var height = maxY - minY;

      var xScale = canvas.width / width;
      var yScale = canvas.height / height;

      var lineWidth = 1;

      context.scale(xScale, yScale);
      context.translate(-minX, -minY);
      context.lineWidth = lineWidth / xScale;

      var rectangularToPolar = function (p) {
        magnitude = Math.sqrt(p.x * p.x + p.y * p.y);
        angle = Math.atan(p.y / p.x);

        if (p.x < 0) {
          angle += Math.PI;
        }
        if (p.y < 0 && p.x > 0) {
          angle += 2 * Math.PI;
        }

        return { magnitude: magnitude, angle: angle };
      };

      var drawBackground = function () {
        context.clearRect(minX, minY, width, height);

        context.strokeStyle = 'red';

        context.setLineDash([0.01, 0.03]);
        context.beginPath();
        context.arc(0, 0, 1, 0, Math.PI * 2);
        context.stroke();

        context.setLineDash([]);
        context.beginPath();
        context.moveTo(minX, 0);
        context.lineTo(maxX, 0);
        context.moveTo(0, minY);
        context.lineTo(0, maxY);
        context.stroke();
      };

      var drawOutput = function (expectedX, expectedY, actualX, actualY) {
        context.strokeStyle = 'black';
        context.beginPath();
        context.moveTo(expectedX, expectedY);
        context.lineTo(actualX, actualY);
        context.stroke();
        context.beginPath();
        context.arc(actualX, actualY, 0.01, 0, Math.PI * 2);
        context.fill();
      };

      var update = function () {
        drawBackground();

        for (var i = 0; i < iterationsPerFrame; ++i) {
          var rectangular;

          while (true) {
            rectangular = {
              x: minX + width * Math.random(),
              y: minY + height * Math.random()
            }

            if (rectangular.x * rectangular.x + rectangular.y * rectangular.y <= 1) {
              break;
            }
          };
          var polar = rectangularToPolar(rectangular);

          neuralNetwork.compute(polar.magnitude, polar.angle);
          neuralNetwork.learn(rectangular.x, rectangular.y);

          drawOutput(rectangular.x, rectangular.y, neuralNetwork.output[0], neuralNetwork.output[1]);
        }

        window.requestAnimationFrame(update);
      };

      update();
    </script>
  </body>
</html>
